# Common Ports and Services

This is going to be a primary reference library that is contain the common methods of exploiting certain common services.

If you run across a port not listed in this chapter, then go check out this fucking awesome page: [http://www.0daysecurity.com/penetration-testing/enumeration.html](http://www.0daysecurity.com/penetration-testing/enumeration.html)

### Port XXX - Service Unknown

If you have a port open but the service is unknown, you can do the following to try to find out which service it might be

```text
root@kali:~$ amap -d <host> <port>
```

### Port 21 - FTP

Connect to the ftp server to enumerate the software and version, along with checking if anonymous access is allowed.  

```text
root@kali:~$ ftp <host>  # anonymous:anonymous 
root@kali:~$ nc <host> <port>
```

#### Modes

Remember that FTP servers have ASCII and Binary modes, if uploading/downloading a binary file, make sure to switch the FTP server into binary mode, otherwise the file will become corrupt and unusable.

### Port 22 - SSH

This is on service, that unless a really old version is running or some boutique app like BearSSH, exploits are unlikely.

#### Banner Grab/Additional Enumeration

```text
# Banner Grab
root@kali:~$ nc <host> <port>

#Get Host Key
root@kali:~$ ssh user@<host>
root@kali:~$ nmap <host> -p 22 -sV --script ssh-hostkey
```

#### Bruteforcing

The following are a list of recommended SSH Brute Forcing Tools

* CeWL/Wordhound
* Hydra
* Patator
* Crowbar
* MSF ssh\_login

### Port 23 - Telnet

The major security concern with Telnet is the lack of encrypting its traffic.  Additionally, exploit-db shows that there are various RCE vulnerabilities on different versions.

#### Bruteforcing

Outside of doing something in bash, hydra can be used

```text
root@kali:~$ hydra -l root -P $SECLISTS/Passwords/<wordlist> <host> telnet
```

### Port 25 - SMTP

SMTP indicates the possibility of outbound mail.  Some commands to try to see what is supported

```text
HELO - 
EHLO - Extended SMTP
STARTTLS - SMTP communicated over unencrypted protocol.
RCPT - Address of the recipient
DATA - Starts the transfer of the message contents
RSET - Used to abort the current email transaction
MAIL - Specifies the email address to the sender
QUIT - Closes the connection
HELP - Asks for the help screen
AUTH - Used to authenticate the client to the server
VRFY - Asks the server to verify if the email user's mailbox exists
```

#### Banner Grab

We will grab the banner and test if a username exists in the database

```text
root@kali:~$ nc <host> 25

220 smtp.localdomain ESMTP Postfix (Ubuntu)
VRFY root
252 2.0.0 root
VRFY rooooot
550 5.1.1 <rooooot>: Recipient address rejected: User unkown
```

`VRFY`, `EXPN`, and `RCPT` can be used to identify users.

Telnet is known to sometimes be more friendly

```text
root@kali:~$ telnet <host> 25
```

#### Automation

Checking for users and which commands are available can be time consuming.  Fortunately, there are some handy tools that can help automate this and save time.

Check for supported commands

```text
root@kali:~$ nmap --script smtp-commands <host>
```

Enumerate users

```text
root@kali:~$ smtp-user-enum -M VRFY -U $SECLISTS/Usernames/<wordlist> -t <host>
```

#### Metasploit

Enumerate users based on a supplied wordlist

```text
msf > use auxiliary/scanner/smtp/smtp_enum
msf auxiliary(smtp_enum) > set rhosts <host>
msf auxiliary(smtp_enum) > set USER_FILE <wordlist>
msf auxiliary(smtp_enum) > run
```

Get the SMTP version

```text
msf > use auxiliary/scanner/smtp/smtp_version
msf auxiliary(smtp_version) > set rhosts <host>
msf auxiliary(smtp_version) > run
```

### Port 69 - TFTP

UDP-based FTP server

### Port 80 - HTTP

#### Banner Grab

```text
root@kali:~$ nc <host> 80
root@kali:~$ nikto -host <host>
```

#### Bruteforcing

Bruteforcing apache basic auth

```text
root@kali:~$ medusa -h <host> -u <user> -P <wordlist> -M http -m DIR:/test -T 10
```

### Port 88 - Kerberos

### Port 110 & 995 - Pop3

Banner grab and access

```text
root@kali:~$ telnet <host> 110
USER <user>@<host>
PASS <password>

#list emails
list

# retrieve 5 messages
retr 5
```

### Port 111 - RPCbind

Assists in looking for NFS shares

```text
root@kali:~$ rpcbind -p <host>
```

### Port 119 - NNTP

### Port 135 - MSRPC

#### Enumeration

```text
root@kali:~$ nmap <host> --script msrpc-enum
msf > use exploit/windows/dcerpc/ms03_026_dcom
nmap -p 135 --script nfs-ls,nfs-statfs,nfs-showmount <host>
```

### Port 139 & 445 - SMB/Samba

#### Connecting

On Linux

```text
root@kali:~$ smbclient -L <host>
root@kali:~$ smbclient //<host>/<dir>
root@kali:~$ smbclient \\\\<host>\\ipc$ -U <user>
root@kali:~$ smbclient //<host>/ipc$ -U <user>
```

To mount

```text
root@kali:~$ mount -t cifs -o user=<username>,sec=ntlm,dir_mode=0077 "//<host>/<share>" /mnt/<dir>
```

#### Connect with PSExec

If you are in posession of credentials

```text
msf > use exploit/windows/smb/psexec
```

#### NMAP Enumeration

There are many smb/samba scripts, the following are 2 of my standard starters

```text
root@kali:~$ nmap -p 139,445 <host> --script smb-enum-services smb-enum-shares smb-os-discovery
```

#### nmblookup

```text
root@kali:~$ nmblookup -A <host>
```

#### nbtscan

```text
root@kali:~$ nbtscan -r <host>
```

#### enum4linux

```text
root@kali:~$ enum4linux -a <host>
```

#### Mount a share

```text
root@kali:~$ smbclient //<host>/<share> -I <host> -N
```

#### Recursively Download Share

```text
root@kali:~$ smbget -R //<host>/<share>
```

#### rpcclient

```text
root@kali:~$ rpcclient -U "" <host>

# Once connected
srvinfo
getdompwinfo
enumdomusers
querydominfo
netshareenum
netshareenumall
enumprivs
lookupnames <user>
lookupids <id>
```

### Port 143 & 993 - IMAP

### Port 161 & 162 - SNMP

#### snmpwalk

```text
root@kali:~$ snmpwalk -c public -v1 <host>
```

Scan for other hosts running snmp

```text
root@kali:~$ nmap -iL iplist.txt -p 161,162 -sU --open -vvv -oA snmp-nmap
```

#### Community String Bruteforce

```text
root@kali:~$ onesixtyone -c <community_wordlist> <host>
```

### Port 199 - Smux

### Port 389 & 636 - LDAP

### Port 443 - HTTPS

### Port 554 - RTSP

### Port 587 - Submission

### Port 631 - Cups

### Port 1025 - NFS or IIS

### Port 1030 & 1032 & 1033 & 1038

### Port 1433 - MSSQL

### Port 1521 - Oracle

### Port 1748 & 1754 & 1808 & 1809 - Oracle Intelligent Agent

### Port 2049 - NFS

Mounting a NFS share

```text
root@kali:~$ mount -t nfs <ip>:<share> /tmp/mount/ -nolock
```

#### Enumeration

Listing all shares

```text
root@kali:~$ showmount -e <host>
```

